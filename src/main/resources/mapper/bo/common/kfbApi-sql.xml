<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.loanscrefia.common.common.repository.KfbApiRepository">

	<!-- 요청 이력 등록 -->
	<insert id="insertKfbApiReqLog" parameterType="kfbApi">
		INSERT INTO TB_LC_KFB_REQ
		(
			 TOKEN
			,URL
			,SEND_DATA
			,SEND_USER
			,SEND_TIMESTAMP
		)
		VALUES
		(
			 #{token}
			,#{url}
			,#{sendData}
			,#{regSeq}
			,NOW()
		)
	</insert>
	
	<!-- 응답 이력 등록 -->
	<insert id="insertKfbApiResLog" parameterType="kfbApi">
		INSERT INTO TB_LC_KFB_RES
		(
			 TOKEN
			,URL
			,RES_CODE
			,RES_MSG
			,RES_DATA
			,RES_TIMESTAMP
		)
		VALUES
		(
			 #{token}
			,#{url}
			,#{resCode}
			,#{resMsg}
			,#{resData}
			,NOW()
		)
	</insert>
	
	<!-- 은행연합회 토큰 저장 -->
	<insert id="insertKfbApiKey" parameterType="string">
   		INSERT INTO KFB_API_KEY
   		VALUES(
   			 TO_CHAR(NOW(),'YYYYMMDD')
   			,#{key}
   			,NOW()
   		)
	</insert>
	
	<!-- 은행연합회 토큰 조회 -->
	<select id="selectKfbApiKey" resultType="string">
		SELECT
			KEY
		FROM KFB_API_KEY
		WHERE INS_DT = TO_CHAR(NOW(),'YYYYMMDD')
	</select>
	
	<!-- 은행연합회에서 전달받은 등록번호 update -->
	<update id="updateKfbApiByUserInfo" parameterType="user">
		UPDATE TB_LC_MAS01
		SET
				 UPD_SEQ 		= #{updSeq}
				,UPD_TIMESTAMP 	= NOW()
			<if test="preLcNum != null and preLcNum != ''">
				,PRE_LC_NUM 	= #{preLcNum}
			</if>
			<if test="plRegistNo != null and plRegistNo != ''">
				,PL_REGIST_NO 	= #{plRegistNo}
			</if>
			<if test="conNum != null and conNum != ''">
				,CON_NUM 		= #{conNum}
			</if>
		<where>
			AND MASTER_SEQ 	= #{masterSeq}
		</where>
	</update>
	
	
	<!-- 은행연합회 토큰 조회 -->
	<select id="selectApiList" parameterType="kfbApi">
   		SELECT 
   			<include refid="common.totalPages"/>
   			Z.*
   		FROM
   		(
			SELECT
				*
			FROM KFB_API_KEY
			<where>
				<if test='creGrp != "2" '>
				
				</if>
			</where>
   		)Z
   		
   		<include refid="common.pageBottom"/>
	</select>
	
	
</mapper> 