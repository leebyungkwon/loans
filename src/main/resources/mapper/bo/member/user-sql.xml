<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.loanscrefia.member.user.repository.UserRepository">
   	
   	<!-- ====================================================================================================== -->
   	<!-- [회원사 시스템 > 모집인 조회 및 변경] -->
   	<!-- ====================================================================================================== -->
   	
   	<!-- 모집인 조회 및 변경 > 리스트 -->
   	<select id="selectUserConfirmList" parameterType="user" resultType="user">
 	   	SELECT 
   			<include refid="common.totalPages"/>
   			Z.*
   		FROM
   		(
   		SELECT 
	    	<include refid="common.totalPages"/>
	    	 TLM.MASTER_SEQ
	    	,TLM.MASTER_TO_ID
			,TLM.COM_CODE
			,FN_COM_CODE(TLM.COM_CODE) AS COM_CODE_NM
			,TLM.MEMBER_SEQ
			,FN_MEMBER_NAME(TLM.MEMBER_SEQ) AS MEMBER_NM
			,TLM.SUB_YN
			,TLM.PRE_REG_YN
			,TLM.PL_CLASS
			,FN_CD_DTL('CLS001',TLM.PL_CLASS) AS PL_CLASS_NM
			,TLM.CORP_USER_YN
			,TLM.CAREER_TYP
			,FN_CD_DTL('CAR001',TLM.CAREER_TYP) AS CAREER_TYP_NM
			,TLM.PL_PRODUCT
			,FN_CD_DTL('PRD001',TLM.PL_PRODUCT) AS PL_PRODUCT_NM
			,TLM.PL_REG_STAT
			,FN_CD_DTL('REG001',TLM.PL_REG_STAT) AS PL_REG_STAT_NM
			,TLM.PL_STAT
			,FN_CD_DTL('MAS001',TLM.PL_STAT) AS PL_STAT_NM
			,TLM.PL_REGIST_NO
			,TLM.CON_NUM
			,TLM.CI
			,TLM.PL_M_NAME
			,TLM.PL_M_Z_ID
			,TLM.PL_M_Z_ID_EDU
			,FN_CELLPHONE(TLM.PL_CELLPHONE) AS PL_CELLPHONE
			,TLM.ADDR
			,TLM.ADDR_DETAIL
			,TLM.PL_EDU_NO
			,TLM.CAREER_START_DATE
			,TLM.CAREER_END_DATE
			,TLM.ENTRUST_DATE
			,TLM.COM_CONT_DATE
			,TLM.PL_MERCHANT_NAME
			,TLM.PL_CEO_NAME
			,TLM.PL_MERCHANT_NO
			,TLM.PL_BUSINESS_NO
			,TLM.COMP_PHONE_NO
			,TLM.CORP_FOUND_DATE
			,TLM.CAPITAL
			,TLM.VOTING_STOCK_CNT
			,TLM.PL_PAY_STAT
			<!-- ,FN_CD_DTL('A0001',TLM.PL_PAY_STAT) AS PL_PAY_STAT_NM -->
			,TO_DATE(TLM.COM_REG_DATE,'YYYYMMDD') AS COM_REG_DATE
			,TLM.CRE_APP_DATE AS ORIGIN_CRE_APP_DATE
			,TO_DATE(TLM.CRE_APP_DATE,'YYYYMMDD') AS CRE_APP_DATE
			,TLM.CRE_LICENSE_DATE AS ORIGIN_CRE_LICENSE_DATE
			,TO_DATE(TLM.CRE_LICENSE_DATE,'YYYYMMDD') AS CRE_LICENSE_DATE
			,TLM.PAY_DATE AS ORIGIN_PAY_DATE
			,TO_DATE(TLM.PAY_DATE,'YYYYMMDD') AS PAY_DATE
			,TLM.SEND_MSG
			,TLM.PL_HIST_CD
			,TLM.COM_HAEJI_DATE
			,TLM.CRE_HAEJI_DATE
			,TLM.FILE_SEQ
			,TO_CHAR(TLM.REG_TIMESTAMP,'YYYY-MM-DD') AS REG_TIMESTAMP
			,TLM.UPD_SEQ
			,TO_CHAR(TLM.UPD_TIMESTAMP,'YYYY-MM-DD') AS UPD_TIMESTAMP
			,(SELECT TLP.PAY_TYPE FROM TB_LC_PAY TLP WHERE TLP.MASTER_SEQ = TLM.MASTER_SEQ ORDER BY TLP.PAY_SEQ DESC LIMIT 1) AS PAY_TYPE
			,(SELECT TLP.NAME FROM TB_LC_PAY TLP WHERE TLP.MASTER_SEQ = TLM.MASTER_SEQ ORDER BY TLP.PAY_SEQ DESC LIMIT 1) AS PAY_NAME
			,(SELECT TLP.REG_TIMESTAMP FROM TB_LC_PAY TLP WHERE TLP.MASTER_SEQ = TLM.MASTER_SEQ ORDER BY TLP.PAY_SEQ DESC LIMIT 1) AS ORIGIN_PAY_REG_DATE
			,(SELECT TO_CHAR(TLP.REG_TIMESTAMP, 'YYYY-MM-DD') FROM TB_LC_PAY TLP WHERE TLP.MASTER_SEQ = TLM.MASTER_SEQ ORDER BY TLP.PAY_SEQ DESC LIMIT 1) AS PAY_REG_DATE
	    FROM TB_LC_MAS01 TLM
		<where>
			<if test='creGrp != "2"'>
				AND	TLM.COM_CODE IN ('1',(SELECT COM_CODE FROM TB_LC_MEMBERS WHERE MEMBER_SEQ = #{regSeq}))	-- 시스템이랑 로그인한 사용자와 동일한 회원사 코드인 정보만 출력
			</if>
				AND TLM.PL_REG_STAT <![CDATA[!=]]> '1'														-- 모집인상태가 승인전이 아닌 것
				AND TLM.PL_STAT NOT IN ('1','2','5','8','10')												-- 처리상태가 미요청, 승인요청, 보완요청(=반려), 취소, 등록요건 불충족(=부적격)이 아닌 것
	    </where>
   		)Z
   		<where>
			<if test="plRegStat != null and plRegStat != ''">
				AND Z.PL_REG_STAT = #{plRegStat}
			</if>		
			<if test="plStat != null and plStat != ''">
				AND Z.PL_STAT = #{plStat}
			</if>
			<if test="plClass != null and plClass != ''">
				<if test='plClass.equals("1") || plClass.equals("2")'>
					AND Z.PL_CLASS 		= #{plClass} 
					AND Z.CORP_USER_YN  = 'N'
				</if>
				<if test='plClass.equals("3")'>
					AND Z.PL_CLASS 		= '1' 
					AND Z.CORP_USER_YN  = 'Y'
				</if>
			</if>
			<if test="plProduct != null and plProduct != ''">
				AND Z.PL_PRODUCT = #{plProduct}
			</if>
			<if test="plMName != null and plMName != ''">
				AND Z.PL_M_NAME LIKE '%' || #{plMName} || '%'
			</if>
			<if test="plMZId != null and plMZId != ''">
				AND Z.PL_M_Z_ID = #{plMZId}
			</if>
			<if test="plCellphone != null and plCellphone != ''">
				AND Z.PL_CELLPHONE LIKE '%' || #{plCellphone} || '%'
			</if>
			<if test="plMerchantName != null and plMerchantName != ''">
				AND Z.PL_MERCHANT_NAME LIKE '%' || #{plMerchantName} || '%'
			</if>
			<if test="plMerchantNo != null and plMerchantNo != ''">
				AND Z.PL_MERCHANT_NO = #{plMerchantNo}
			</if>
			<if test="plRegistNo != null and plRegistNo != ''">
				AND Z.PL_REGIST_NO LIKE '%' || #{plRegistNo} || '%'
			</if>
			<if test="masterToId != null and masterToId != ''">
				AND Z.MASTER_TO_ID LIKE '%' || #{masterToId} || '%'
			</if>
	    	<choose>
   				<when test="srchSelect2 != null and srchSelect2 != ''">
					<if test="srchSelect2.equals('creAppDate')">
						<if test="srchDate1 != null and srchDate1 != ''">
							AND Z.ORIGIN_CRE_APP_DATE::TIMESTAMP <![CDATA[>=]]> #{srchDate1}::TIMESTAMP
						</if>
						<if test="srchDate2 != null and srchDate2 != ''">
							AND Z.ORIGIN_CRE_APP_DATE::TIMESTAMP <![CDATA[<]]> #{srchDate2}::TIMESTAMP + INTERVAL '1 day'
						</if>
					</if>
					<if test="srchSelect2.equals('payDate')">
						<if test="srchDate1 != null and srchDate1 != ''">
							AND Z.ORIGIN_PAY_REG_DATE::TIMESTAMP <![CDATA[>=]]> #{srchDate1}::TIMESTAMP
						</if>
						<if test="srchDate2 != null and srchDate2 != ''">
							AND Z.ORIGIN_PAY_REG_DATE::TIMESTAMP <![CDATA[<]]> #{srchDate2}::TIMESTAMP + INTERVAL '1 day'
						</if>
					</if>
					<if test="srchSelect2.equals('creLicenseDate')">
						<if test="srchDate1 != null and srchDate1 != ''">
							AND Z.ORIGIN_CRE_LICENSE_DATE::TIMESTAMP <![CDATA[>=]]> #{srchDate1}::TIMESTAMP
						</if>
						<if test="srchDate2 != null and srchDate2 != ''">
							AND Z.ORIGIN_CRE_LICENSE_DATE::TIMESTAMP <![CDATA[<]]> #{srchDate2}::TIMESTAMP + INTERVAL '1 day'
						</if>
					</if>
				</when>
			</choose>
	    </where>
	    <include refid="common.pageBottom"/>
   	</select>
   	
   	<!-- 모집인 조회 및 변경 > 법인사용인 존재유무 -->
   	<select id="selectCorpUserCnt" parameterType="user" resultType="int">
   		SELECT
   			COUNT(*)
   		FROM TB_LC_MAS01
   		WHERE CORP_USER_YN 	= 'Y'
   		AND PL_REG_STAT <![CDATA[!=]]> '4'					-- 해지완료가 아닌 법인사용인
   		AND PL_STAT <![CDATA[!=]]> '8'						-- 즉시취소가 아닌 법인사용인
   		AND PL_MERCHANT_NO 	= #{plMerchantNo}
   	</select>
   	
   	<!-- 모집인 조회 및 변경 > -->
   	<!-- 모집인 조회 및 변경 > -->
   	<!-- 모집인 조회 및 변경 > -->
   	
   	
   	<!-- ====================================================================================================== -->
   	<!-- [회원사 시스템 > 모집인 등록] -->
   	<!-- ====================================================================================================== -->
   	
	<!-- 모집인 등록 > 리스트 -->
   	<select id="selectUserRegList" parameterType="user" resultType="user">
   		SELECT 
   			<include refid="common.totalPages"/>
   			Z.*
   		FROM
   		(
   			SELECT 
		    	 TLM.MASTER_SEQ
		    	,TLM.MASTER_TO_ID
				,TLM.COM_CODE
				,FN_COM_CODE(TLM.COM_CODE) AS COM_CODE_NM
				,TLM.MEMBER_SEQ
				,FN_MEMBER_NAME(TLM.MEMBER_SEQ) AS MEMBER_NM
				,TLM.SUB_YN
				,TLM.PRE_REG_YN
				,TLM.PL_CLASS
				,FN_CD_DTL('CLS001',TLM.PL_CLASS) AS PL_CLASS_NM
				,TLM.PL_WORK
				,TLM.CORP_USER_YN
				,TLM.CAREER_TYP
				,FN_CD_DTL('CAR001',TLM.CAREER_TYP) AS CAREER_TYP_NM
				,TLM.PL_PRODUCT
				,FN_CD_DTL('PRD001',TLM.PL_PRODUCT) AS PL_PRODUCT_NM
				,TLM.PL_REG_STAT
				,FN_CD_DTL('REG001',TLM.PL_REG_STAT) AS PL_REG_STAT_NM
				,TLM.PL_STAT
				,FN_CD_DTL('MAS001',TLM.PL_STAT) AS PL_STAT_NM
				,TLM.PL_REGIST_NO
				,TLM.CON_NUM
				,TLM.CI
				,TLM.PL_M_NAME
				,TLM.PL_M_Z_ID
				,TLM.PL_M_Z_ID_EDU
				,FN_CELLPHONE(TLM.PL_CELLPHONE) AS PL_CELLPHONE
				,TLM.ADDR
				,TLM.ADDR_DETAIL
				,TLM.PL_EDU_NO
				,TLM.CAREER_START_DATE
				,TLM.CAREER_END_DATE
				,TLM.ENTRUST_DATE
				,TLM.COM_CONT_DATE
				,TLM.PL_MERCHANT_NAME
				,TLM.PL_CEO_NAME
				,TLM.PL_MERCHANT_NO
				,TLM.PL_BUSINESS_NO
				,TLM.COMP_PHONE_NO
				,TLM.CORP_FOUND_DATE
				,TLM.CAPITAL
				,TLM.VOTING_STOCK_CNT
				,TLM.PL_PAY_STAT
				<!-- ,FN_CD_DTL('A0001',TLM.PL_PAY_STAT) AS PL_PAY_STAT_NM -->
				,TLM.COM_REG_DATE
				,TLM.CRE_APP_DATE
				,TLM.CRE_LICENSE_DATE
				,TLM.PAY_DATE
				,TLM.SEND_MSG
				,TLM.PL_HIST_CD
				,TLM.COM_HAEJI_DATE
				,TLM.CRE_HAEJI_DATE
				,TLM.FILE_SEQ
				,CASE 
					WHEN 
						TLM.PL_CLASS = '1' AND TLM.CAREER_TYP = '1' -- 개인(신규)
							AND TLM.FILE_SEQ IS NOT NULL 
							AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('1','2','4','6','8','14')) = 6
					THEN 'Y'
					WHEN 
						TLM.PL_CLASS = '1' AND TLM.CAREER_TYP = '2' -- 개인(경력)
							AND TLM.FILE_SEQ IS NOT NULL
							AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('1','2','3','6','8','14')) = 6
					THEN 'Y'
					WHEN 
						TLM.PL_CLASS = '2' 
							AND TLM.FILE_SEQ IS NOT NULL 
							AND (SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ) > 0	-- 임원 한명이상 등록 필수
							AND (SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ) > 0	-- 전문인력 한명이상 등록 필수
							AND (SELECT COUNT(1) FROM TB_LC_MAS01_IT TLMT WHERE TLMT.MASTER_SEQ = TLM.MASTER_SEQ) > 0		-- 전산인력 한명이상 등록 필수
							AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('1','2','3','5','15','31')) = 6 -- 법인(등록정보)
							AND (
									SELECT 
										COUNT(1) 
									FROM TB_LC_FILE01 TLF 
									WHERE TLF.FILE_GRP_SEQ IN (SELECT TLMI.FILE_SEQ FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '1') 
									AND TLF.USE_YN = 'Y' 
									AND TLF.FILE_TYPE IN ('7','13','30','33')
								 ) = 4 * (SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '1') -- 법인(임원) : 신규
							AND (
									SELECT 
										COUNT(1) 
									FROM TB_LC_FILE01 TLF 
									WHERE TLF.FILE_GRP_SEQ IN (SELECT TLMI.FILE_SEQ FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '2') 
									AND TLF.USE_YN = 'Y' 
									AND TLF.FILE_TYPE IN ('7','12','30','33')
								 ) = 4 * (SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '2') -- 법인(임원) : 경력 
							AND (
									SELECT 
										COUNT(1) 
									FROM TB_LC_FILE01 TLF 
									WHERE TLF.FILE_GRP_SEQ IN (SELECT TLME.FILE_SEQ FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '1') 
									AND TLF.USE_YN = 'Y' 
									AND TLF.FILE_TYPE IN ('17')
								 ) = 1 * (SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '1') -- 법인(전문인력) : 신규
							AND (
									SELECT 
										COUNT(1) 
									FROM TB_LC_FILE01 TLF 
									WHERE TLF.FILE_GRP_SEQ IN (SELECT TLME.FILE_SEQ FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '2') 
									AND TLF.USE_YN = 'Y' 
									AND TLF.FILE_TYPE IN ('16')
								 ) = 1 * (SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '2') -- 법인(전문인력) : 경력
							AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('21','22','23','25','26','29')) = 6 -- 법인(기타)
					THEN 'Y'
					ELSE 'N'
				 END AS FILE_COMP_YN
				,CASE 
					WHEN 
						TLM.PL_CLASS = '1' AND TLM.CAREER_TYP = '1' -- 개인(신규)
							AND TLM.FILE_SEQ IS NOT NULL 
							AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('1','2','4','6','8','14')) = 6
					THEN '완료'
					WHEN 
						TLM.PL_CLASS = '1' AND TLM.CAREER_TYP = '2' -- 개인(경력)
							AND TLM.FILE_SEQ IS NOT NULL 
							AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('1','2','3','6','8','14')) = 6
					THEN '완료'
					WHEN 
						TLM.PL_CLASS = '2' 
							AND TLM.FILE_SEQ IS NOT NULL 
							AND (SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ) > 0	-- 임원 한명이상 등록 필수
							AND (SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ) > 0	-- 전문인력 한명이상 등록 필수
							AND (SELECT COUNT(1) FROM TB_LC_MAS01_IT TLMT WHERE TLMT.MASTER_SEQ = TLM.MASTER_SEQ) > 0		-- 전산인력 한명이상 등록 필수
							AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('1','2','3','5','15','31')) = 6 -- 법인(등록정보)
							AND (
									SELECT 
										COUNT(1) 
									FROM TB_LC_FILE01 TLF 
									WHERE TLF.FILE_GRP_SEQ IN (SELECT TLMI.FILE_SEQ FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '1') 
									AND TLF.USE_YN = 'Y' 
									AND TLF.FILE_TYPE IN ('7','13','30','33')
								 ) = 4 * (SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '1') -- 법인(임원) : 신규
							AND (
									SELECT 
										COUNT(1) 
									FROM TB_LC_FILE01 TLF 
									WHERE TLF.FILE_GRP_SEQ IN (SELECT TLMI.FILE_SEQ FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '2') 
									AND TLF.USE_YN = 'Y' 
									AND TLF.FILE_TYPE IN ('7','12','30','33')
								 ) = 4 * (SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '2') -- 법인(임원) : 경력 
							AND (
									SELECT 
										COUNT(1) 
									FROM TB_LC_FILE01 TLF 
									WHERE TLF.FILE_GRP_SEQ IN (SELECT TLME.FILE_SEQ FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '1') 
									AND TLF.USE_YN = 'Y' 
									AND TLF.FILE_TYPE IN ('17')
								 ) = 1 * (SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '1') -- 법인(전문인력) : 신규
							AND (
									SELECT 
										COUNT(1) 
									FROM TB_LC_FILE01 TLF 
									WHERE TLF.FILE_GRP_SEQ IN (SELECT TLME.FILE_SEQ FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '2') 
									AND TLF.USE_YN = 'Y' 
									AND TLF.FILE_TYPE IN ('16')
								 ) = 1 * (SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '2') -- 법인(전문인력) : 경력
							AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('21','22','23','25','26','29')) = 6 -- 법인(기타)
					THEN '완료'
					ELSE '미완료'
				 END AS FILE_COMP_TXT
				,(SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.PL_EDU_NO IS NOT NULL AND TLMI.PL_EDU_NO != '') AS IMWON_EDU_CNT -- 법인(임원)은 유효한 교육이수번호가 한명이상 등록 필수
				,TLM.REG_TIMESTAMP AS ORIGIN_REG_TIMESTAMP
				,TO_CHAR(TLM.REG_TIMESTAMP,'YYYY-MM-DD') AS REG_TIMESTAMP
				,TLM.UPD_SEQ
				,TLM.UPD_TIMESTAMP AS ORIGIN_UPD_TIMESTAMP
				,TO_CHAR(TLM.UPD_TIMESTAMP,'YYYY-MM-DD') AS UPD_TIMESTAMP
		    FROM TB_LC_MAS01 TLM
			<where>
				<if test='creGrp != "2"'>
					AND	TLM.COM_CODE IN ('3000001',(SELECT COM_CODE FROM TB_LC_MEMBERS WHERE MEMBER_SEQ = #{regSeq}))	-- 시스템이랑 로그인한 사용자와 동일한 회원사 코드인 정보만 출력
				</if>
					AND TLM.PL_REG_STAT = '1'																			-- 모집인 상태가 승인전인 것
					AND TLM.PL_STAT IN ('1','2','5','10')																-- 처리상태가 미요청, 승인요청, 반려(보완요청), 등록요건 불충족(=부적격)인 것
		    </where>
   		)Z
   		<where>
   			<if test="memberNm != null and memberNm != ''">
				AND Z.MEMBER_NM LIKE '%' || #{memberNm} || '%'
			</if>
			<if test="plClass != null and plClass != ''">
				<if test='plClass.equals("1") || plClass.equals("2")'>
					AND Z.PL_CLASS 		= #{plClass} 
					AND Z.CORP_USER_YN  = 'N'
				</if>
				<if test='plClass.equals("3")'>
					AND Z.PL_CLASS 		= '1' 
					AND Z.CORP_USER_YN  = 'Y'
				</if>
			</if>
			<if test="plProduct != null and plProduct != ''">
				AND Z.PL_PRODUCT = #{plProduct}
			</if>
			<if test="plMName != null and plMName != ''">
				AND Z.PL_M_NAME LIKE '%' || #{plMName} || '%'
			</if>
			<if test="plMZId != null and plMZId != ''">
				AND Z.PL_M_Z_ID = #{plMZId}
			</if>
			<if test="plCellphone != null and plCellphone != ''">
				AND Z.PL_CELLPHONE LIKE '%' || #{plCellphone} || '%'
			</if>
			<if test="plMerchantName != null and plMerchantName != ''">
				AND Z.PL_MERCHANT_NAME LIKE '%' || #{plMerchantName} || '%'
			</if>
			<if test="plMerchantNo != null and plMerchantNo != ''">
				AND Z.PL_MERCHANT_NO = #{plMerchantNo}
			</if>
			<if test="fileCompYn != null and fileCompYn != ''">
				AND Z.FILE_COMP_YN = #{fileCompYn}
			</if>
	    	<if test="plStat != null and plStat != ''">
				AND Z.PL_STAT = #{plStat}
			</if>
			<if test="masterToId != null and masterToId != ''">
				AND Z.MASTER_TO_ID LIKE '%' || #{masterToId} || '%'
			</if>
			<if test="srchDate1 != null and srchDate1 != ''">
				AND Z.ORIGIN_REG_TIMESTAMP <![CDATA[>=]]> #{srchDate1}::TIMESTAMP
			</if>
			<if test="srchDate2 != null and srchDate2 != ''">
				AND Z.ORIGIN_REG_TIMESTAMP <![CDATA[<]]> #{srchDate2}::TIMESTAMP + INTERVAL '1 day'
			</if>
	    </where>
	    <include refid="common.pageBottom"/>
   	</select>
   	
   	<!-- 모집인 중복체크 -->
   	<select id="userRegDupChk" parameterType="user" resultType="int">
   		SELECT 
   			COUNT(*)
   		FROM TB_LC_MAS01
   		WHERE PL_STAT NOT IN ('8','10','11','12')
   		<choose>
  			<when test='plClass != null and !plClass.equals("") and plClass.equals("1")'> -- 개인일 때
  				AND PL_CLASS 	= '1'
  				AND PL_PRODUCT 	= #{plProduct}
  				AND CI 			= #{ci}
  				<if test='plProduct != null and !plProduct.equals("") and plProduct.equals("05")'>
  				AND COM_CODE	= (SELECT COM_CODE FROM TB_LC_MEMBERS WHERE MEMBER_SEQ = #{regSeq})
  				</if>
			</when>
			<when test='plClass != null and !plClass.equals("") and plClass.equals("2")'> -- 법인일 때
				AND PL_CLASS 	= '2'
				AND PL_PRODUCT 	= #{plProduct}
				AND CI 			= #{ci}
				<if test='plProduct != null and !plProduct.equals("") and !plProduct.equals("01")'>
  				AND COM_CODE	= (SELECT COM_CODE FROM TB_LC_MEMBERS WHERE MEMBER_SEQ = #{regSeq})
  				</if>
			</when>
		</choose>
   	</select>
   
   	<!-- 모집인 등록 > 개인 등록 -->
   	<insert id="insertUserRegIndvInfoByExcel" parameterType="user">
   		INSERT INTO TB_LC_MAS01
   		(
			 MASTER_TO_ID
			,COM_CODE
			,MEMBER_SEQ
			,PL_REG_STAT
			,PL_STAT
			,PL_CLASS
			,CORP_USER_YN
			,CAREER_TYP
			,PL_M_NAME
			,PL_M_Z_ID
			,PL_CELLPHONE
			,ADDR
			,ADDR_DETAIL
			,PL_PRODUCT
			,PL_MERCHANT_NAME
			,PL_MERCHANT_NO
			,PL_EDU_NO
			,CAREER_START_DATE
			,CAREER_END_DATE
			,COM_CONT_DATE
			,ENTRUST_DATE
			,CI
			,PRE_LC_NUM
			,PRE_REG_YN
			,REG_TIMESTAMP
   		)
   		VALUES
   		<foreach collection="excelParam" item="item" separator=",">
   		(
   			 (SELECT 'LC' || TO_CHAR(CURRENT_DATE,'YYMMDD') || LPAD(CAST(NEXTVAL('tb_lc_mas01_seq') as VARCHAR(8)) , 8, '0'))
   			,(SELECT COM_CODE FROM TB_LC_MEMBERS WHERE MEMBER_SEQ = #{regSeq})
   			,#{regSeq}
   			,'1'							-- 승인전
   			,'1'							-- 승인미요청
   			,'1'		 					-- 개인,법인
   			<choose>
   				<when test="(item.G != null and item.G != '') and (item.H != null and item.H != '')">
					,'Y'
				</when>
				<otherwise>
					,'N'
				</otherwise>
			</choose>
   			,#{item.A} 						-- 신규,경력
   			,#{item.B} 						-- 이름
   			,#{item.C}						-- 주민등록번호
   			,REPLACE(#{item.D}, '-', '')	-- 휴대폰번호
   			,#{item.E}						-- 주소
   			,#{item.F}						-- 상세주소
   			,CONCAT('0',#{item.G})			-- 금융상품유형
   			,#{item.H}						-- 법인명
   			,#{item.I}						-- 법인등록번호
   			,#{item.J}						-- 교육이수번호/인증서번호
   			,REPLACE(#{item.K}, '-', '')	-- 경력시작일
   			,REPLACE(#{item.L}, '-', '')	-- 경력종료일
   			,REPLACE(#{item.M}, '-', '')	-- 계약일자
   			,REPLACE(#{item.N}, '-', '')	-- 위탁예정기간
   			,#{item.O}						-- CI
   			,#{item.preLcNum}				-- 가등록 번호
   			,#{item.preRegYn}				-- 수수료 기 납부 여부
   			,NOW()
   		)
   		</foreach>
   	</insert>
   	
   	<!-- 모집인 등록 > 법인 등록 -->
   	<insert id="insertUserRegCorpInfoByExcel" parameterType="user">
   		INSERT INTO TB_LC_MAS01
   		(
			 MASTER_TO_ID
			,COM_CODE
			,MEMBER_SEQ
			,PL_REG_STAT
			,PL_STAT
			,PL_CLASS
			,PL_MERCHANT_NAME
			,PL_CEO_NAME
			,PL_M_Z_ID
			,PL_CELLPHONE
			,PL_MERCHANT_NO
			,CORP_FOUND_DATE
			,ADDR
			,ADDR_DETAIL
			,CAPITAL
			,VOTING_STOCK_CNT
			,PL_PRODUCT
			,COM_CONT_DATE
			,ENTRUST_DATE
			,CI
			,PRE_LC_NUM
			,PRE_REG_YN
			,PL_WORK
			,REG_TIMESTAMP
   		)
   		VALUES
   		<foreach collection="excelParam" item="item" separator=",">
   		(
   			 (SELECT 'LC' || TO_CHAR(CURRENT_DATE,'YYMMDD') || LPAD(CAST(NEXTVAL('tb_lc_mas01_seq') as VARCHAR(8)) , 8, '0'))
   			,(SELECT COM_CODE FROM TB_LC_MEMBERS WHERE MEMBER_SEQ = #{regSeq})
   			,#{regSeq}
   			,'1'							-- 승인전
   			,'1'							-- 승인미요청
   			,'2' 							-- 개인,법인
   			,#{item.A}						-- 상호
			,#{item.B}						-- 대표이사
			,#{item.C}						-- 주민등록번호
   			,REPLACE(#{item.D}, '-', '')	-- 휴대폰번호
			,#{item.E}						-- 법인등록번호
   			,REPLACE(#{item.F}, '-', '')	-- 설립년월일
			,#{item.G}						-- 본점소재지
			,#{item.H}						-- 상세주소(법인등기부본상)
			,#{item.I}						-- 자본금
			,#{item.J}						-- 의결권있는 발행주식 총수
			,CONCAT('0',#{item.K})			-- 금융상품유형
			,REPLACE(#{item.L}, '-', '')	-- 계약일자
   			,REPLACE(#{item.M}, '-', '')	-- 위탁예정기간
   			,#{item.N}						-- CI
   			,#{item.preLcNum}				-- 가등록 번호
   			,#{item.preRegYn}				-- 수수료 기 납부 여부
   			,#{item.O}						-- 업종
   			,NOW()
   		)
   		</foreach>
   	</insert>
   	
   	<!-- 모집인 등록 > 법인 : 대표자 및 임원 정보 등록 -->
   	<insert id="insertUserRegCorpImwonInfoByExcel" parameterType="userImwon">
   		INSERT INTO TB_LC_MAS01_IMWON
   		(
   			 MASTER_SEQ
			,CAREER_TYP
			,POSITION_NM
			,EXC_NAME
			,PL_M_Z_ID
			,PL_EDU_NO
			,CAREER_START_DATE
			,CAREER_END_DATE
			,FULL_TM_STAT
			,EXPERT_STAT
   		)
   		VALUES
   		<foreach collection="excelParam" item="item" separator=",">
   		(
   			 #{masterSeq}
   			,#{item.A}						-- 구분(신규,경력)
   			,#{item.B}						-- 직위
   			,#{item.C}						-- 성명
   			,#{item.D}						-- 주민등록번호
   			,#{item.E}						-- 교육이수번호/인증서번호
   			,REPLACE(#{item.F}, '-', '')	-- 경력시작일
   			,REPLACE(#{item.G}, '-', '')	-- 경력종료일
   			,#{item.H}						-- 상근여부
   			,#{item.I}						-- 전문인력여부
   		)
   		</foreach>
   	</insert>
   	
   	<!-- 모집인 등록 > 법인 : 대표자 및 임원 정보 등록 -->
   	<insert id="insertUserRegCorpImwonInfo" parameterType="userImwon">
   		INSERT INTO TB_LC_MAS01_IMWON
   		(
   			 MASTER_SEQ
			,CAREER_TYP
			,POSITION_NM
			,EXC_NAME
			,PL_M_Z_ID
			,PL_EDU_NO
			,CAREER_START_DATE
			,CAREER_END_DATE
			,FULL_TM_STAT
			,EXPERT_STAT
			,FILE_SEQ
   		)
   		VALUES
   		(
   			 #{masterSeq}
   			,#{careerTyp}
   			,#{positionNm}
   			,#{excName}
   			,#{plMZId}
   			,#{plEduNo}
   			,REPLACE(#{careerStartDate}, '-', '')
   			,REPLACE(#{careerEndDate}, '-', '')
   			,#{fullTmStat}
   			,#{expertStat}
   			,#{fileSeq}
   		)
   	</insert>
   	
   	<!-- 모집인 등록 > 법인 : 전문인력 정보 등록 -->
   	<insert id="insertUserRegCorpExpertInfoByExcel" parameterType="userExpert">
   		INSERT INTO TB_LC_MAS01_EXPERT
   		(
   			 MASTER_SEQ
			,CAREER_TYP
			,EXP_NAME
			,PL_M_Z_ID
			,PL_EDU_NO
			,CAREER_START_DATE
			,CAREER_END_DATE
   		)
   		VALUES
   		<foreach collection="excelParam" item="item" separator=",">
   		(
   			 #{masterSeq}
   			,#{item.A}						-- 구분(신규,경력)
   			,#{item.B}						-- 성명
   			,#{item.C}						-- 주민등록번호
   			,#{item.D}						-- 교육이수번호/인증서번호
   			,REPLACE(#{item.E}, '-', '')	-- 경력시작일
   			,REPLACE(#{item.F}, '-', '')	-- 경력종료일
   		)
   		</foreach>
   	</insert>
   	
   	<!-- 모집인 등록 > 법인 : 전문인력 정보 등록 -->
   	<insert id="insertUserRegCorpExpertInfo" parameterType="userExpert">
   		INSERT INTO TB_LC_MAS01_EXPERT
   		(
   			 MASTER_SEQ
			,CAREER_TYP
			,EXP_NAME
			,PL_M_Z_ID
			,PL_EDU_NO
			,CAREER_START_DATE
			,CAREER_END_DATE
			,FILE_SEQ
   		)
   		VALUES
   		(
   			 #{masterSeq}
   			,#{careerTyp}
   			,#{expName}
   			,#{plMZId}
   			,#{plEduNo}
   			,REPLACE(#{careerStartDate}, '-', '')
   			,REPLACE(#{careerEndDate}, '-', '')
   			,#{fileSeq}
   		)
   	</insert>
   	
   	<!-- 모집인 등록 > 법인 : 전산인력 정보 등록 -->
   	<insert id="insertUserRegCorpItInfoByExcel" parameterType="userIt">
   		INSERT INTO TB_LC_MAS01_IT
   		(
   			 MASTER_SEQ
			,OPER_NAME
			,PL_M_Z_ID
   		)
   		VALUES
   		<foreach collection="excelParam" item="item" separator=",">
   		(
   			 #{masterSeq}
   			,#{item.A}						-- 성명
   			,#{item.B}						-- 주민등록번호
   		)
   		</foreach>
   	</insert>
   	
   	<!-- 모집인 등록 > 법인 : 전산인력 정보 등록 -->
   	<insert id="insertUserRegCorpItInfo" parameterType="userIt">
   		INSERT INTO TB_LC_MAS01_IT
   		(
   			 MASTER_SEQ
			,OPER_NAME
			,PL_M_Z_ID
			,FILE_SEQ
   		)
   		VALUES
   		(
   			 #{masterSeq}
   			,#{operName}
   			,#{plMZId}
   			,#{fileSeq}
   		)
   	</insert>
   
   	<!-- 모집인 등록 > 상세 -->
   	<select id="getUserRegDetail" parameterType="user" resultType="user">
   		SELECT 
	    	 TLM.MASTER_SEQ
	    	,TLM.MASTER_TO_ID
			,TLM.COM_CODE
			,FN_COM_CODE(TLM.COM_CODE) AS COM_CODE_NM
			,TLM.MEMBER_SEQ
			,FN_MEMBER_NAME(TLM.MEMBER_SEQ) AS MEMBER_NM
			,(SELECT EMAIL FROM TB_LC_MEMBERS WHERE MEMBER_SEQ = TLM.MEMBER_SEQ) AS EMAIL
			,FN_CELLPHONE((SELECT MOBILE_NO FROM TB_LC_MEMBERS WHERE MEMBER_SEQ = TLM.MEMBER_SEQ)) AS MOBILE_NO
			,TLM.SUB_YN
			,TLM.PRE_REG_YN
			,TLM.PL_CLASS
			,FN_CD_DTL('CLS001',TLM.PL_CLASS) AS PL_CLASS_NM
			,TLM.PL_WORK
			,TLM.CORP_USER_YN
			,TLM.CAREER_TYP
			,FN_CD_DTL('CAR001',TLM.CAREER_TYP) AS CAREER_TYP_NM
			,TLM.PL_PRODUCT
			,FN_CD_DTL('PRD001',TLM.PL_PRODUCT) AS PL_PRODUCT_NM
			,TLM.PL_REG_STAT
			,FN_CD_DTL('REG001',TLM.PL_REG_STAT) AS PL_REG_STAT_NM
			,TLM.PL_STAT
			,FN_CD_DTL('MAS001',TLM.PL_STAT) AS PL_STAT_NM
			,TLM.PL_REGIST_NO
			,TLM.CON_NUM
			,TLM.CI
			,TLM.PL_M_NAME
			,TLM.PL_M_Z_ID
			,FN_CELLPHONE(TLM.PL_CELLPHONE) AS PL_CELLPHONE
			,TLM.ADDR
			,FN_CD_DTL('ADD001',TLM.ADDR) AS ADDR_NM
			,TLM.ADDR_DETAIL
			,TLM.PL_EDU_NO
			,CASE
				WHEN TLM.CAREER_START_DATE IS NULL THEN NULL
				WHEN TLM.CAREER_START_DATE = '' THEN NULL
				ELSE TO_DATE(TLM.CAREER_START_DATE,'YYYYMMDD')
			 END AS CAREER_START_DATE
			,CASE
				WHEN TLM.CAREER_END_DATE IS NULL THEN NULL
				WHEN TLM.CAREER_END_DATE = '' THEN NULL
				ELSE TO_DATE(TLM.CAREER_END_DATE,'YYYYMMDD')
			 END AS CAREER_END_DATE
			,CASE
				WHEN TLM.ENTRUST_DATE IS NULL THEN NULL
				WHEN TLM.ENTRUST_DATE = '' THEN NULL
				ELSE TO_DATE(TLM.ENTRUST_DATE,'YYYYMMDD')
			 END AS ENTRUST_DATE
			,CASE
				WHEN TLM.COM_CONT_DATE IS NULL THEN NULL
				WHEN TLM.COM_CONT_DATE = '' THEN NULL
				ELSE TO_DATE(TLM.COM_CONT_DATE,'YYYYMMDD')
			 END AS COM_CONT_DATE 
			,TLM.PL_MERCHANT_NAME
			,TLM.PL_CEO_NAME
			,TLM.PL_MERCHANT_NO AS ORIGIN_PL_MERCHANT_NO
			,TLM.PL_MERCHANT_NO
			,TLM.PL_BUSINESS_NO
			,TLM.COMP_PHONE_NO
			,TO_DATE(TLM.CORP_FOUND_DATE,'YYYYMMDD') AS CORP_FOUND_DATE
			,TLM.CAPITAL
			,TLM.VOTING_STOCK_CNT
			,TLM.PL_PAY_STAT
			<!-- ,FN_CD_DTL('A0001',TLM.PL_PAY_STAT) AS PL_PAY_STAT_NM -->
			,TLM.COM_REG_DATE
			,TLM.CRE_APP_DATE
			,TLM.CRE_LICENSE_DATE
			,TLM.PAY_DATE
			,TLM.SEND_MSG
			,TLM.PL_HIST_CD
			,FN_CD_DTL('DRP001',TLM.PL_HIST_CD) AS PL_HIST_CD_NM
			,TLM.PL_HIST_TXT
			,TO_DATE(TLM.COM_HAEJI_DATE,'YYYYMMDD') AS COM_HAEJI_DATE
			,TO_DATE(TLM.CRE_HAEJI_DATE,'YYYYMMDD') AS CRE_HAEJI_DATE
			,TLM.FILE_SEQ
			,TLM.PRE_LC_NUM
			,TO_CHAR(TLM.REG_TIMESTAMP,'YYYY-MM-DD') AS REG_TIMESTAMP
			,TLM.UPD_SEQ
			,TO_CHAR(TLM.UPD_TIMESTAMP,'YYYY-MM-DD') AS UPD_TIMESTAMP
			,(SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ) AS IMWON_CNT
			,(SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ) AS EXPERT_CNT
			,(SELECT COUNT(1) FROM TB_LC_MAS01_IT TLMT WHERE TLMT.MASTER_SEQ = TLM.MASTER_SEQ) AS IT_CNT
			,CASE 
				WHEN 
					TLM.PL_CLASS = '1' AND TLM.CAREER_TYP = '1' -- 개인(신규)
						AND TLM.FILE_SEQ IS NOT NULL 
						AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('1','2','4','6','8','14')) = 6
				THEN 'Y'
				WHEN 
					TLM.PL_CLASS = '1' AND TLM.CAREER_TYP = '2' -- 개인(경력)
						AND TLM.FILE_SEQ IS NOT NULL
						AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('1','2','3','6','8','14')) = 6
				THEN 'Y'
				WHEN 
					TLM.PL_CLASS = '2' 
						AND TLM.FILE_SEQ IS NOT NULL 
						AND (SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ) > 0	-- 임원 한명이상 등록 필수
						AND (SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ) > 0	-- 전문인력 한명이상 등록 필수
						AND (SELECT COUNT(1) FROM TB_LC_MAS01_IT TLMT WHERE TLMT.MASTER_SEQ = TLM.MASTER_SEQ) > 0		-- 전산인력 한명이상 등록 필수
						AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('1','2','3','5','15','31')) = 6 -- 법인(등록정보)
						AND (
								SELECT 
									COUNT(1) 
								FROM TB_LC_FILE01 TLF 
								WHERE TLF.FILE_GRP_SEQ IN (SELECT TLMI.FILE_SEQ FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '1') 
								AND TLF.USE_YN = 'Y' 
								AND TLF.FILE_TYPE IN ('7','13','30','33')
							 ) = 4 * (SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '1') -- 법인(임원) : 신규
						AND (
								SELECT 
									COUNT(1) 
								FROM TB_LC_FILE01 TLF 
								WHERE TLF.FILE_GRP_SEQ IN (SELECT TLMI.FILE_SEQ FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '2') 
								AND TLF.USE_YN = 'Y' 
								AND TLF.FILE_TYPE IN ('7','12','30','33')
							 ) = 4 * (SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '2') -- 법인(임원) : 경력 
						AND (
								SELECT 
									COUNT(1) 
								FROM TB_LC_FILE01 TLF 
								WHERE TLF.FILE_GRP_SEQ IN (SELECT TLME.FILE_SEQ FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '1') 
								AND TLF.USE_YN = 'Y' 
								AND TLF.FILE_TYPE IN ('17')
							 ) = 1 * (SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '1') -- 법인(전문인력) : 신규
						AND (
								SELECT 
									COUNT(1) 
								FROM TB_LC_FILE01 TLF 
								WHERE TLF.FILE_GRP_SEQ IN (SELECT TLME.FILE_SEQ FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '2') 
								AND TLF.USE_YN = 'Y' 
								AND TLF.FILE_TYPE IN ('16')
							 ) = 1 * (SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '2') -- 법인(전문인력) : 경력
						AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('21','22','23','25','26','29')) = 6 -- 법인(기타)
				THEN 'Y'
				ELSE 'N'
			 END AS FILE_COMP_YN
			,CASE 
				WHEN 
					TLM.PL_CLASS = '2' 
						AND TLM.FILE_SEQ IS NOT NULL 
						AND (SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ) > 0	-- 임원 한명이상 등록 필수
						AND (
								SELECT 
									COUNT(1) 
								FROM TB_LC_FILE01 TLF 
								WHERE TLF.FILE_GRP_SEQ IN (SELECT TLMI.FILE_SEQ FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '1') 
								AND TLF.USE_YN = 'Y' 
								AND TLF.FILE_TYPE IN ('7','13','30','33')
							 ) = 4 * (SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '1') -- 법인(임원) : 신규
						AND (
								SELECT 
									COUNT(1) 
								FROM TB_LC_FILE01 TLF 
								WHERE TLF.FILE_GRP_SEQ IN (SELECT TLMI.FILE_SEQ FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '2') 
								AND TLF.USE_YN = 'Y' 
								AND TLF.FILE_TYPE IN ('7','12','30','33')
							 ) = 4 * (SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.CAREER_TYP = '2') -- 법인(임원) : 경력 
				THEN 'Y'
				ELSE 'N'
			 END AS IMWON_FILE_COMP_YN
			,CASE 
				WHEN 
					TLM.PL_CLASS = '2' 
						AND TLM.FILE_SEQ IS NOT NULL 
						AND (SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ) > 0	-- 전문인력 한명이상 등록 필수
						AND (
								SELECT 
									COUNT(1) 
								FROM TB_LC_FILE01 TLF 
								WHERE TLF.FILE_GRP_SEQ IN (SELECT TLME.FILE_SEQ FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '1') 
								AND TLF.USE_YN = 'Y' 
								AND TLF.FILE_TYPE IN ('17')
							 ) = 1 * (SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '1') -- 법인(전문인력) : 신규
						AND (
								SELECT 
									COUNT(1) 
								FROM TB_LC_FILE01 TLF 
								WHERE TLF.FILE_GRP_SEQ IN (SELECT TLME.FILE_SEQ FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '2') 
								AND TLF.USE_YN = 'Y' 
								AND TLF.FILE_TYPE IN ('16')
							 ) = 1 * (SELECT COUNT(1) FROM TB_LC_MAS01_EXPERT TLME WHERE TLME.MASTER_SEQ = TLM.MASTER_SEQ AND TLME.CAREER_TYP = '2') -- 법인(전문인력) : 경력
				THEN 'Y'
				ELSE 'N'
			 END AS EXPERT_FILE_COMP_YN
			,CASE 
				WHEN 
					TLM.PL_CLASS = '2' 
						AND TLM.FILE_SEQ IS NOT NULL 
						AND (SELECT COUNT(1) FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLM.FILE_SEQ AND TLF.USE_YN = 'Y' AND TLF.FILE_TYPE IN ('21','22','23','25','26','29')) = 6 -- 법인(기타)
				THEN 'Y'
				ELSE 'N'
			 END AS ETC_FILE_COMP_YN
			,(SELECT COUNT(1) FROM TB_LC_MAS01_IMWON TLMI WHERE TLMI.MASTER_SEQ = TLM.MASTER_SEQ AND TLMI.PL_EDU_NO IS NOT NULL AND TLMI.PL_EDU_NO != '') AS IMWON_EDU_CNT -- 법인(임원)은 유효한 교육이수번호가 한명이상 등록 필수
	    FROM TB_LC_MAS01 TLM
	    <where>
	    	AND TLM.MASTER_SEQ = #{masterSeq}
	    </where>
   	</select>
   	
   	<!-- 모집인 등록 > 법인 : 대표자 및 임원 리스트 -->
   	<select id="selectUserRegCorpImwonList" parameterType="userImwon" resultType="userImwon">
   		SELECT 
			 EXC_SEQ
			,MASTER_SEQ
			,CAREER_TYP
			,FN_CD_DTL('CAR001',CAREER_TYP) AS CAREER_TYP_NM
			,POSITION_NM
			,EXC_NAME
			,PL_M_Z_ID
			,PL_EDU_NO
			,CASE
				WHEN CAREER_START_DATE IS NULL THEN NULL
				WHEN CAREER_START_DATE = '' THEN NULL
				ELSE TO_DATE(CAREER_START_DATE,'YYYYMMDD')
			 END AS CAREER_START_DATE
			,CASE
				WHEN CAREER_END_DATE IS NULL THEN NULL
				WHEN CAREER_END_DATE = '' THEN NULL
				ELSE TO_DATE(CAREER_END_DATE,'YYYYMMDD')
			 END AS CAREER_END_DATE
			,FULL_TM_STAT
			,FN_CD_DTL('FTM001',FULL_TM_STAT) AS FULL_TM_STAT_NM
			,EXPERT_STAT
			,FN_CD_DTL('EXP001',EXPERT_STAT) AS EXPERT_STAT_NM
			,FILE_SEQ
   		FROM TB_LC_MAS01_IMWON
   		<where>
   			AND MASTER_SEQ = #{masterSeq}
   		</where>
   		ORDER BY EXC_SEQ ASC
   	</select>
   	
   	<!-- 모집인 등록 > 법인 : 대표자 및 임원 상세 -->
   	<select id="getUserRegCorpImwonInfo" parameterType="userImwon" resultType="userImwon">
   		SELECT 
			 TLMI.EXC_SEQ
			,TLMI.MASTER_SEQ
			,TLMI.CAREER_TYP
			,FN_CD_DTL('CAR001',TLMI.CAREER_TYP) AS CAREER_TYP_NM
			,TLMI.POSITION_NM
			,TLMI.EXC_NAME
			,TLMI.PL_M_Z_ID
			,TLMI.PL_EDU_NO
			,TO_DATE(TLMI.CAREER_START_DATE,'YYYYMMDD') AS CAREER_START_DATE
			,TO_DATE(TLMI.CAREER_END_DATE,'YYYYMMDD') AS CAREER_END_DATE
			,TLMI.FULL_TM_STAT
			,FN_CD_DTL('FTM001',TLMI.FULL_TM_STAT) AS FULL_TM_STAT_NM
			,TLMI.EXPERT_STAT
			,FN_CD_DTL('EXP001',TLMI.EXPERT_STAT) AS EXPERT_STAT_NM
			,TLMI.FILE_SEQ
			,(SELECT TLF.FILE_SEQ FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLMI.FILE_SEQ AND TLF.FILE_TYPE = '12' AND TLF.USE_YN = 'Y') AS CAREER_FILE_SEQ
			,(SELECT TLF.FILE_SEQ FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLMI.FILE_SEQ AND TLF.FILE_TYPE = '13' AND TLF.USE_YN = 'Y') AS NEWCOMER_FILE_SEQ
		FROM TB_LC_MAS01_IMWON TLMI
   		<where>
   			AND TLMI.EXC_SEQ = #{excSeq}
   		</where>
   	</select>
   	
   	<!-- 모집인 등록 > 법인 : 전문인력 리스트 -->
   	<select id="selectUserRegCorpExpertList" parameterType="userExpert" resultType="userExpert">
   		SELECT
			 EXP_SEQ
			,MASTER_SEQ
			,CAREER_TYP
			,FN_CD_DTL('CAR001',CAREER_TYP) AS CAREER_TYP_NM
			,EXP_NAME
			,PL_M_Z_ID
			,PL_EDU_NO
			,CASE
				WHEN CAREER_START_DATE IS NULL THEN NULL
				WHEN CAREER_START_DATE = '' THEN NULL
				ELSE TO_DATE(CAREER_START_DATE,'YYYYMMDD')
			 END AS CAREER_START_DATE
			,CASE
				WHEN CAREER_END_DATE IS NULL THEN NULL
				WHEN CAREER_END_DATE = '' THEN NULL
				ELSE TO_DATE(CAREER_END_DATE,'YYYYMMDD')
			 END AS CAREER_END_DATE
			,FILE_SEQ
   		FROM TB_LC_MAS01_EXPERT
   		<where>
   			AND MASTER_SEQ = #{masterSeq}
   		</where>
   		ORDER BY EXP_SEQ ASC
   	</select>
   	
   	<!-- 모집인 등록 > 법인 : 전문인력 상세 -->
   	<select id="getUserRegCorpExpertInfo" parameterType="userExpert" resultType="userExpert">
   		SELECT 
			 TLME.EXP_SEQ
			,TLME.MASTER_SEQ
			,TLME.CAREER_TYP
			,FN_CD_DTL('CAR001',TLME.CAREER_TYP) AS CAREER_TYP_NM
			,TLME.EXP_NAME
			,TLME.PL_M_Z_ID
			,TLME.PL_EDU_NO
			,TO_DATE(TLME.CAREER_START_DATE,'YYYYMMDD') AS CAREER_START_DATE
			,TO_DATE(TLME.CAREER_END_DATE,'YYYYMMDD') AS CAREER_END_DATE
			,TLME.FILE_SEQ
			,(SELECT TLF.FILE_SEQ FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLME.FILE_SEQ AND TLF.FILE_TYPE = '16' AND TLF.USE_YN = 'Y') AS CAREER_FILE_SEQ
			,(SELECT TLF.FILE_SEQ FROM TB_LC_FILE01 TLF WHERE TLF.FILE_GRP_SEQ = TLME.FILE_SEQ AND TLF.FILE_TYPE = '17' AND TLF.USE_YN = 'Y') AS NEWCOMER_FILE_SEQ
   		FROM TB_LC_MAS01_EXPERT TLME
   		<where>
   			AND TLME.EXP_SEQ = #{expSeq}
   		</where>
   	</select>
   	
   	<!-- 모집인 등록 > 법인 : 전산인력 리스트 -->
   	<select id="selectUserRegCorpItList" parameterType="userIt" resultType="userIt">
   		SELECT
	   		 OPER_SEQ
			,MASTER_SEQ
			,OPER_NAME
			,PL_M_Z_ID
			,FILE_SEQ
   		FROM TB_LC_MAS01_IT
   		<where>
   			AND MASTER_SEQ = #{masterSeq}
   		</where>
   		ORDER BY OPER_SEQ ASC
   	</select>
   
	<!-- 모집인 등록 > 수정 -->
   	<update id="updateUserRegInfo" parameterType="user">
   		UPDATE TB_LC_MAS01
   		SET
   			  FILE_SEQ 			= #{fileSeq}
   			<if test="plMName != null and plMName != ''">
   			 ,PL_M_NAME 		= #{plMName}
   			</if>
   			<if test="plMZId != null and plMZId != ''">
   			,PL_M_Z_ID 			= #{plMZId}
   			</if>
   			<if test="plCellphone != null and plCellphone != ''">
   			,PL_CELLPHONE 		= REPLACE(#{plCellphone}, '-', '')
   			</if>
   			<if test="addr != null and addr != ''">
   			,ADDR 				= #{addr}
   			</if>
   			<if test="addrDetail != null and addrDetail != ''">
   			,ADDR_DETAIL		= #{addrDetail}
   			</if>
   			<if test="careerStartDate != null and careerStartDate != ''">
   			,CAREER_START_DATE 	= REPLACE(#{careerStartDate}, '-', '')
   			</if>
   			<if test="careerEndDate != null and careerEndDate != ''">
   			,CAREER_END_DATE 	= REPLACE(#{careerEndDate}, '-', '')
   			</if>
   			<if test="comContDate != null and comContDate != ''">
   			,COM_CONT_DATE 		= REPLACE(#{comContDate}, '-', '')
   			</if>
   			<if test="entrustDate != null and entrustDate != ''">
   			,ENTRUST_DATE 		= REPLACE(#{entrustDate}, '-', '')
   			</if>
   			
   			<if test="plMerchantName != null and plMerchantName != ''">
   			,PL_MERCHANT_NAME	= #{plMerchantName}
   			</if>
   			<if test="plCeoName != null and plCeoName != ''">
   			,PL_CEO_NAME 		= #{plCeoName}
   			</if>
   			<if test="corpFoundDate != null and corpFoundDate != ''">
   			,CORP_FOUND_DATE 	= REPLACE(#{corpFoundDate}, '-', '')
   			</if>
   			<if test="capital != null and capital != ''">
   			,CAPITAL 			= #{capital}
   			</if>
   			<if test="votingStockCnt != null and votingStockCnt != ''">
   			,VOTING_STOCK_CNT	= #{votingStockCnt}
   			</if>
   			,PL_WORK 			= #{plWork}
   			,UPD_SEQ 			= #{updSeq}
   			,UPD_TIMESTAMP 		= NOW()
   		<where>
	    	AND MASTER_SEQ 		= #{masterSeq}
	    	AND PL_STAT			!= '2'			-- 승인요청상태가 아닐 때만 수정 가능
	    </where>
   	</update>
   	
   	<!-- 모집인 등록 > 법인 : 대표자 및 임원 정보 수정 -->
	<update id="updateUserRegCorpImwonInfo" parameterType="userImwon">
		UPDATE TB_LC_MAS01_IMWON
		SET
			 POSITION_NM		= #{positionNm}
			,EXC_NAME			= #{excName}
			,PL_M_Z_ID			= #{plMZId}
			,CAREER_START_DATE	= REPLACE(#{careerStartDate}, '-', '')
			,CAREER_END_DATE	= REPLACE(#{careerEndDate}, '-', '')
			,FULL_TM_STAT		= #{fullTmStat}
			,EXPERT_STAT		= #{expertStat}
			,FILE_SEQ			= #{fileSeq}
		<where>
	    	AND EXC_SEQ = #{excSeq}
	    </where>
	</update>
   	
   	<!-- 모집인 등록 > 법인 : 전문인력 정보 수정 -->
   	<update id="updateUserRegCorpExpertInfo" parameterType="userExpert">
   		UPDATE TB_LC_MAS01_EXPERT
		SET
			 EXP_NAME			= #{expName}
			,PL_M_Z_ID			= #{plMZId}
			,CAREER_START_DATE	= REPLACE(#{careerStartDate}, '-', '')
			,CAREER_END_DATE	= REPLACE(#{careerEndDate}, '-', '')
			,FILE_SEQ			= #{fileSeq}
		<where>
	    	AND EXP_SEQ = #{expSeq}
	    </where>
   	</update>
   	
   	<!-- 모집인 등록 > 법인 : 전산인력 정보 수정 -->
   	<update id="updateUserRegCorpItInfo" parameterType="userIt">
   		UPDATE TB_LC_MAS01_IT
   		SET
   			 OPER_NAME		= #{operName}
			,PL_M_Z_ID		= #{plMZId}
			,FILE_SEQ		= #{fileSeq}
   		<where>
	    	AND OPER_SEQ 	= #{operSeq}
	    </where>
   	</update>
   	
   	<!-- 모집인 등록 : 모집인 정보 삭제 -->
   	<delete id="deleteUserRegInfo" parameterType="user">
		DELETE FROM TB_LC_MAS01
		<where>
	    	AND MASTER_SEQ = #{masterSeq}
	    </where>
	</delete>
	
	<!-- 모집인 등록 : 법인사용인 정보 삭제 -->
   	<delete id="deleteCorpUserRegInfo" parameterType="user">
		DELETE FROM TB_LC_MAS01
		<where>
	    	AND PL_CLASS 		= '1'
	    	AND CORP_USER_YN 	= 'Y'
	   		AND PL_MERCHANT_NO 	= #{plMerchantNo}
	    </where>
	</delete>
   	
	<!-- 모집인 등록 > 법인 : 대표자 및 임원 정보 삭제 -->
	<delete id="deleteUserRegCorpImwonInfo" parameterType="userImwon">
		DELETE FROM TB_LC_MAS01_IMWON
		<where>
	    	AND EXC_SEQ = #{excSeq}
	    </where>
	</delete>
 	
   	<!-- 모집인 등록 > 법인 : 전문인력 정보 삭제 -->
   	<delete id="deleteUserRegCorpExpertInfo" parameterType="userExpert">
   		DELETE FROM TB_LC_MAS01_EXPERT
		<where>
	    	AND EXP_SEQ = #{expSeq}
	    </where>
	</delete>
   	
   	<!-- 모집인 등록 > 법인 : 전산인력 정보 삭제 -->
   	<delete id="deleteUserRegCorpItInfo" parameterType="userIt">
   		DELETE FROM TB_LC_MAS01_IT
		<where>
	    	AND OPER_SEQ 	= #{operSeq}
	    </where>
	</delete>
	
	<!-- 모집인 등록 > 법인 : 대표자 및 임원 정보 삭제(masterSeq 사용) -->
	<delete id="deleteUserRegCorpImwonInfoByMasterSeq" parameterType="userImwon">
		DELETE FROM TB_LC_MAS01_IMWON
		<where>
	    	AND MASTER_SEQ = #{masterSeq}
	    </where>
	</delete>
 	
   	<!-- 모집인 등록 > 법인 : 전문인력 정보 삭제(masterSeq 사용) -->
   	<delete id="deleteUserRegCorpExpertInfoByMasterSeq" parameterType="userExpert">
   		DELETE FROM TB_LC_MAS01_EXPERT
		<where>
	    	AND MASTER_SEQ = #{masterSeq}
	    </where>
	</delete>
   	
   	<!-- 모집인 등록 > 법인 : 전산인력 정보 삭제(masterSeq 사용) -->
   	<delete id="deleteUserRegCorpItInfoByMasterSeq" parameterType="userIt">
   		DELETE FROM TB_LC_MAS01_IT
		<where>
	    	AND MASTER_SEQ = #{masterSeq}
	    </where>
	</delete>
   	
   	<!-- ====================================================================================================== -->
   	<!-- [모집인 상태 / 처리상태 변경 관련] -->
   	<!-- ====================================================================================================== -->
   	
   	<!-- 처리상태 변경 -->
	<update id="updateUserStat" parameterType="user">
		UPDATE TB_LC_MAS01
		SET
			 PL_STAT 		= #{plStat}
			<if test="plRegStat != null and plRegStat != ''">
			,PL_REG_STAT 	= #{plRegStat}
			</if>
			<if test="plHistTxt != null and plHistTxt != ''">
			,PL_HIST_TXT 	= #{plHistTxt}
			</if>
			<if test='plStat.equals("4")'>
			,PL_HIST_CD		= #{plHistCd}
			,COM_HAEJI_DATE	= TO_CHAR(NOW(),'YYYYMMDD')
			,CRE_HAEJI_DATE	= TO_CHAR(NOW(),'YYYYMMDD')
			</if>
			<if test='plStat.equals("2") or plStat.equals("5") or plStat.equals("6") or plStat.equals("7")'>
			,CRE_APP_FI_DATE = case
									when cre_app_fi_date is null or cre_app_fi_date = '' then TO_CHAR(NOW()::date + interval '60 days', 'YYYYMMDD')
									when cre_app_fi_date is not null or cre_app_fi_date != '' then TO_CHAR((NOW()::date - com_upd_date::date) + cre_app_fi_date::date, 'YYYYMMDD')
								else cre_app_fi_date
								end
			</if>
			<if test='plStat.equals("2") or plStat.equals("3") or plStat.equals("4")'>
			,COM_REG_DATE	= TO_CHAR(NOW(),'YYYYMMDD')
			</if>
			,UPD_SEQ 		= #{updSeq}
			,UPD_TIMESTAMP 	= NOW()
		<where>
			AND MASTER_SEQ 	= #{masterSeq}
		</where>
	</update>
	
	<!-- 법인 승인여부 체크 -->
	<select id="corpStatCheck" parameterType="user" resultType="int">
		SELECT
			COUNT(*)
		FROM TB_LC_MAS01
		WHERE PL_CLASS 		= '2' 				-- 법인
		AND PL_MERCHANT_NO 	= #{plMerchantNo}
		AND PL_REG_STAT 	= '3'				-- 모집인상태 : 자격취득
		AND PL_STAT			= '9'				-- 처리상태 : 완료
		AND PL_PRODUCT		= #{plProdcut}
		AND COM_CODE		= (SELECT COM_CODE FROM TB_LC_MEMBERS WHERE MEMBER_SEQ = #{regSeq})
	</select>
	
	<!-- ====================================================================================================== -->
   	<!-- [모집인 위반이력 관련] -->
   	<!-- ====================================================================================================== -->
	
	<!-- 위반이력 삭제 -->
	<delete id="deleteUserViolationInfo" parameterType="user">
		DELETE FROM TB_LC_VIOLATION
		WHERE VIOLATION_SEQ = #{violationSeq}
	</delete>
	
	<!-- 위반이력 삭제요청 -->
	<update id="applyDeleteUserViolationInfo" parameterType="user">
		UPDATE TB_LC_VIOLATION
		SET
			 APPLY_YN 		= 'Y'
			,UPD_SEQ		= #{updSeq}
			,UPD_TIMESTAMP	= NOW()
		WHERE
			VIOLATION_SEQ = #{violationSeq}
	</update>
	
	<!-- 위반이력 저장 -->
	<insert id="insertUserViolationInfo" parameterType="user">
		INSERT INTO TB_LC_VIOLATION
		(
			 MASTER_SEQ
			,VIOLATION_CD
			,REG_SEQ
			,REG_TIMESTAMP
		)
		VALUES
		(
			 #{masterSeq}
			,#{violationCd}
			,#{regSeq}
			,NOW()
		)
	</insert>
	
	<!-- 위반이력 리스트 -->
	<select id="selectUserViolationInfoList" parameterType="user" resultType="user">
		SELECT
			 VIOLATION_SEQ
			,MASTER_SEQ
			,VIOLATION_CD
			,FN_CD_DTL('VIT001',VIOLATION_CD) AS VIOLATION_CD_NM
			,VIO_NUM
			,APPLY_YN
			,REG_SEQ
			,TO_CHAR(REG_TIMESTAMP, 'YYYYMMDD') AS REG_TIMESTAMP
			,UPD_SEQ
			,UPD_TIMESTAMP
		FROM TB_LC_VIOLATION
		WHERE MASTER_SEQ = #{masterSeq}
		<if test="vioNum != null and vioNum != ''">
			<if test='vioNum.equals("empty")'>
				AND (VIO_NUM IS NULL OR VIO_NUM = '')
				AND APPLY_YN = 'N'
			</if>
			<if test='vioNum.equals("notEmpty")'>
				AND APPLY_YN = 'Y'
			</if>			
		</if>
		ORDER BY VIOLATION_SEQ ASC
	</select>
	
	<!-- 위반이력 수정 -->
	<insert id="updateUserViolationInfo" parameterType="user">
		UPDATE TB_LC_VIOLATION
		SET
			VIO_NUM = #{vioNum}
		WHERE
			VIOLATION_SEQ = #{violationSeq}
	</insert>
   	
</mapper> 